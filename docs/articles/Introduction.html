<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to eulerr • eulerr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">eulerr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jolars/eulerr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>An introduction to eulerr</h1>
                        <h4 class="author">Johan Larsson</h4>
            
            <h4 class="date">2017-02-05</h4>
          </div>

    
    
<div class="contents">
<p><strong>eulerr</strong> generates area-proportional euler diagrams that display set relationships (intersections, unions, and disjoints) with circles. <a href="https://en.wikipedia.org/wiki/Euler_diagram">Euler diagrams</a> are Venn diagrams without the requirement that all set interactions be present (whether they are empty or not). That is, depending on input, eulerr will sometimes produce Venn diagrams but sometimes not.</p>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#background" class="anchor"> </a></body></html>Background</h2>
<p>R features a number of packages that produce euler and/or venn diagrams; some of the more prominent ones (on CRAN) are</p>
<ul>
<li>
<a href="https://cran.r-project.org/package=eVenn">eVenn</a>,</li>
<li>
<a href="https://cran.r-project.org/package=VennDiagram">VennDiagram</a>,</li>
<li>
<a href="https://cran.r-project.org/package=venn">venn</a>,</li>
<li>
<a href="https://cran.r-project.org/package=colorfulVennPlot">colorfulVennPlot</a>, and</li>
<li>
<a href="https://cran.r-project.org/package=venneuler">venneuler</a>.</li>
</ul>
<p>The last of these (venneuler) serves as the primary inspiration for this package, along with the refinements that Ben Fredrickson has presented on his <a href="http://www.benfrederickson.com/">blog</a> and made available in his javascript <a href="https://github.com/benfred/venn.js">venn.js</a>.</p>
<p>venneuler, however, is known to produce imperfect output for set configurations that have perfect solutions. Consider, for instance, the following example in which the intersection between <code>A</code> and <code>B</code> is both needless and unwanted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">venn_fit &lt;-<span class="st"> </span>venneuler::<span class="kw">venneuler</span>(<span class="kw">c</span>(<span class="dt">A =</span> <span class="dv">75</span>, <span class="dt">B =</span> <span class="dv">50</span>, <span class="st">"A&amp;B"</span> =<span class="st"> </span><span class="dv">0</span>))
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw">plot</span>(venn_fit)</code></pre></div>
<div class="figure">
<img src="Introduction_files/figure-html/venneuler_failure-1.png" alt="venneuler plot with unwanted overlap." width="480"><p class="caption">
venneuler plot with unwanted overlap.
</p>
</div>
</div>
<div id="enter-eulerr" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#enter-eulerr" class="anchor"> </a></body></html>Enter eulerr</h2>
<p>eulerr is based on the improvements to <strong>venneuler</strong> that Ben Fredrickson introduced with <strong>venn.js</strong> but has been recoded from scratch, uses different optimizers, and returns statistics featured in <code>venneuler</code> and <code>eulerAPE</code>.</p>
<div id="input" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#input" class="anchor"> </a></body></html>Input</h3>
<p>At the time of writing, it is possible to provide input to <code>eulerr</code> as either</p>
<ul>
<li>a named numeric vector with set combinations as
<ul>
<li>disjoint set combinations or</li>
<li>unions</li>
</ul>
</li>
<li>a matrix of logicals with columns representing sets and rows the set relationships for each observation.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eulerr)

<span class="co"># Input in the form of a named numeric vector</span>
fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/euler.html">euler</a></span>(<span class="kw">c</span>(<span class="st">"A"</span> =<span class="st"> </span><span class="dv">25</span>, <span class="st">"B"</span> =<span class="st"> </span><span class="dv">5</span>, <span class="st">"C"</span> =<span class="st"> </span><span class="dv">5</span>,
                <span class="st">"A&amp;B"</span> =<span class="st"> </span><span class="dv">5</span>, <span class="st">"A&amp;C"</span> =<span class="st"> </span><span class="dv">5</span>, <span class="st">"B&amp;C"</span> =<span class="st"> </span><span class="dv">3</span>,
                <span class="st">"A&amp;B&amp;C"</span> =<span class="st"> </span><span class="dv">3</span>))

<span class="co"># Input as a matrix of logicals</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
mat &lt;-<span class="st"> </span><span class="kw">cbind</span>(
  <span class="dt">A =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dt">size =</span> <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
  <span class="dt">B =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dt">size =</span> <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
  <span class="dt">C =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>), <span class="dt">size =</span> <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
)
fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/euler.html">euler</a></span>(mat)</code></pre></div>
</div>
<div id="fit" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#fit" class="anchor"> </a></body></html>Fit</h3>
<p>We inspect our results by printing the eulerr object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit2</code></pre></div>
<pre><code>##       original fitted residuals region_error
## A           10 10.025    -0.025        0.003
## B            7  7.040    -0.040        0.003
## C            5  5.049    -0.049        0.002
## A&amp;B         15 14.966     0.034        0.003
## A&amp;C          1  0.563     0.437        0.010
## B&amp;C          2  1.777     0.223        0.005
## A&amp;B&amp;C        5  5.071    -0.071        0.003
## 
## diag_error:  0.01 
## stress:      0.001</code></pre>
<p>or directly access and plot the residuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Cleveland dot plot of the residuals</span>
<span class="kw">dotchart</span>(<span class="kw">resid</span>(fit2))
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</code></pre></div>
<div class="figure">
<img src="Introduction_files/figure-html/residual_plot-1.png" alt="Residuals for the eulerr fit." width="672"><p class="caption">
Residuals for the eulerr fit.
</p>
</div>
<p>This shows us that the <code>A&amp;B&amp;C</code> intersection is somewhat overrepresented in <code>fit2</code>. Given that these residuals are on the scale of the original values, however, the residuals are arguably of little concern.</p>
<p>As an alternative, we could plot the circles in another program by retrieving their coordinates and radii</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(fit2)</code></pre></div>
<pre><code>##            x           y        r
## A   4.582381   0.4106434 20.94457
## B  -5.196963   4.7051254 20.32999
## C -11.965642 -11.6757970 13.35932</code></pre>
</div>
<div id="starting-configuration" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#starting-configuration" class="anchor"> </a></body></html>Starting configuration</h3>
<p>A starting configuration is obtained via a constrained version of multidimensional scaling that has been explained thoroughly <a href="http://www.benfrederickson.com/better-venn-diagrams/">elsewhere</a>.</p>
</div>
<div id="optimization" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#optimization" class="anchor"> </a></body></html>Optimization</h3>
<p>The starting configuration is based solely on the two-way relationships of the sets so has to be optimized for most set relationships. We try to optimize the coordinates and radii of the solution with the objective of producing a diagram that is as <em>accurate</em> as possible. In this context, however, accuracy is an ambigious objective that has produced a slew of proposals. eulerr uses the sums of squares as the target loss function to minimize</p>
<p><span class="math display">\[\sum_{i=1}^{n} (y_i - \hat{y}_i) ^ 2\]</span> where <span class="math inline">\(\hat{y}\)</span> is the fitted disjoint areas.</p>
</div>
<div id="goodness-of-fit" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#goodness-of-fit" class="anchor"> </a></body></html>Goodness-of-fit</h3>
<p>For goodness-of-fit measures, we the stress statistic from venneuler (<span class="citation">Wilkinson (2012)</span>)</p>
<p><span class="math display">\[\frac{\sum_{i=1}^{n} (y_i - \hat{y}_i) ^ 2}{\sum_{i=1}^{n} y_i ^ 2}\]</span> where <span class="math inline">\(\hat{y}_i\)</span> is an ordinary least squares estimate from the regression of the fitted areas on the original areas that is being explored during optimization.</p>
<p>We also provide the diagError statistic from eulerAPE (<span class="citation">Micallef and Rodgers (2014–17AD)</span>):</p>
<p><span class="math display">\[ \max_{i = 1, 2, \dots, n} \left| \frac{y_i}{\sum y_i} - \frac{\hat{y}_i}{\sum \hat{y}_i} \right|\]</span> In our example, the diagError is <code>0.0096</code> and our stress is <code>6\times 10^{-4}</code>, suggesting that the fit is accurate.</p>
<p>We can now be confident that eulerr provides a reasonable representation of our input. Were it otherwise, we would do best to stop here and look for another way to visualize our data. (I suggest the excellent <a href="https://cran.r-project.org/package=UpSetR">UpSetR</a> package.)</p>
</div>
<div id="plotting" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#plotting" class="anchor"> </a></body></html>Plotting</h3>
<p>No we get to the fun part: plotting our diagram. This is easy, as well as highly customizable, with eulerr.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(fit2)

<span class="co"># Remove fills, vary border type, and switch fontface.</span>
<span class="kw">plot</span>(fit2, <span class="dt">fill =</span> <span class="st">"transparent"</span>, <span class="dt">lty =</span> <span class="dv">1</span>:<span class="dv">3</span>, <span class="dt">fontface =</span> <span class="dv">4</span>)</code></pre></div>
<div class="figure">
<img src="Introduction_files/figure-html/eulerr_plot-1.png" alt="eulerr plots can be modified in every possible way." width="384"><img src="Introduction_files/figure-html/eulerr_plot-2.png" alt="eulerr plots can be modified in every possible way." width="384"><p class="caption">
eulerr plots can be modified in every possible way.
</p>
</div>
<p>eulerr’s default color palette is taken from <a href="https://cran.r-project.org/package=qualpalr">qualpalr</a> – another package that I have developed – which uses color difference algorithms to generate distinct qualitative color palettes.</p>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#acknowledgements" class="anchor"> </a></body></html>Acknowledgements</h2>
<p>eulerr would not be possible without Ben Fredrickson’s work on <a href="http://www.benfrederickson.com">venn.js</a> or Leland Wilkinson’s <a href="https://cran.r-project.org/package=venneuler">venneuler</a>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>References</h2>
<div id="refs" class="references">
<div id="ref-micallef2014">
<p>Micallef, Luana, and Peter Rodgers. 2014–17AD. “EulerAPE: Drawing Area-Proportional 3-Venn Diagrams Using Ellipses.” <em>PLOS ONE</em> 9 (7): e101717. doi:<a href="https://doi.org/10.1371/journal.pone.0101717">10.1371/journal.pone.0101717</a>.</p>
</div>
<div id="ref-wilkinson_exact_2012">
<p>Wilkinson, L. 2012. “Exact and Approximate Area-Proportional Circular Venn and Euler Diagrams.” <em>IEEE Transactions on Visualization and Computer Graphics</em> 18 (2): 321–31. doi:<a href="https://doi.org/10.1109/TVCG.2011.56">10.1109/TVCG.2011.56</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li><a href="#enter-eulerr">Enter eulerr</a></li>
      <li><a href="#acknowledgements">Acknowledgements</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Johan Larsson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
